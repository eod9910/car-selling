const express = require('express');
const path = require('path');
const app = express();

// The Library (Server)
console.log('Setting up the Harvard of libraries...');

// Librarian's tools (Middleware)
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Main Library Shelves (Static Files)
console.log('Arranging books on the main shelves...');
app.use(express.static(path.join(__dirname, 'public')));

// Archive Room Access (API Routes)
console.log('Unlocking the archive room...');
app.use('/api', require('./routes/api'));

// Specific Book Requests (Main Routes)
console.log('Preparing to handle specific book requests...');

// Main Reading Room (Public Site)
app.get('/', (req, res) => {
  console.log('Visitor requested the main reading room...');
  res.sendFile(path.join(__dirname, 'public', 'index.html'));
});

// Librarian's Office (Admin Dashboard)
app.get('/admin', (req, res) => {
  console.log('Staff member accessing the librarian\'s office...');
  res.sendFile(path.join(__dirname, 'admin', 'index.html'));
});

// Add more specific routes as needed

// General Inquiry Desk (Catch-all Route)
app.get('*', (req, res) => {
  console.log('Visitor made an unusual request, directing them appropriately...');
  if (req.path.startsWith('/admin')) {
    res.sendFile(path.join(__dirname, 'admin', 'index.html'));
  } else {
    res.sendFile(path.join(__dirname, 'public', 'index.html'));
  }
});

// Lost and Found (Error Handling)
app.use((err, req, res, next) => {
  console.error('Oh no! A book fell off the shelf:', err.stack);
  res.status(500).send('Our apologies, we had a mishap in the library. Please ask the librarian for assistance.');
});

// Opening the Library (Starting the Server)
const PORT = process.env.PORT || 3001;
app.listen(PORT, () => {
  console.log(`The Harvard of libraries is now open at http://localhost:${PORT}`);
  console.log('Welcome, esteemed readers and researchers!');
});